% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/suggest_df.R
\name{suggest_df}
\alias{suggest_df}
\title{Suggest Optimal Starting Values for Effective Degrees of Freedom}
\usage{
suggest_df(
  data,
  ns_score = FALSE,
  plots = FALSE,
  models = FALSE,
  use_weights = FALSE,
  na_rm = TRUE
)
}
\arguments{
\item{data}{A \code{list} or \code{data.table} containing columns \code{SampleID},
\code{ReplicateID}, \code{MP_A} and \code{MP_B}.}

\item{ns_score}{A \code{logical}. If \code{TRUE}, calculates non-linearity scores for
each method used to derive optimal effective DOF values. See details.}

\item{plots}{A \code{logical}. If \code{TRUE}, generates model assessment and \eqn{\zeta} dynamics
plots.}

\item{models}{A \code{logical}. If \code{TRUE}, returns the six optimal \code{smooth.spline}
objects in the output.}

\item{use_weights}{A code{logical}. If \code{TRUE}, uses weights in the algorithms.
Weights are automatically determined based on \code{data}.}

\item{na_rm}{A \code{logical}. If \code{TRUE}, removes NA values before modeling. Note
that this affects algorithm results but not measurement variance or replicate
count calculations.}
}
\value{
The output structure varies based on \code{ns_score}, \code{plots} and \code{models} parameters:
\itemize{
   \item If \code{plots = FALSE} and \code{models = FALSE}: A \code{data.table} (2x6 or 3x6 if \code{ns_score = TRUE})
   \item Otherwise: A \code{list} containing elements \code{table}, \code{plots}, and/or \code{models}
}
}
\description{
This function addresses the challenge of determining suitable values for the
             degrees of freedom \code{df} parameter in smoothing splines, particularly for
             small sample sizes common in commutability evaluations. It provides
             comprehensive data analysis and suggests multiple optimal \code{df} values using
             six different algorithms.
}
\details{
Algorithms

The function employs six algorithms to determine optimal \code{df} values:
\itemize{
   \item Four variants of \eqn{\zeta} minimization
   \item Leave-One-Out Cross-Validation (LOOCV)
   \item Generalized Cross-Validation (GCV)
}

While none of these methods are entirely robust for typical sample sizes,
they provide valuable insights when used in conjunction with the output plots.

Non-linearity Scores

When \code{ns_score = TRUE}, the function calculates non-linearity scores based on
\itemize{
   \item For minimizing \eqn{\zeta(\mathrm{df})}: Score = -1 + \eqn{\int_{2}^{3}\zeta(\mathrm{t}) dt}
   \item For minimizing \eqn{\zeta'(\mathrm{df})}: Score = \eqn{-0.001 \cdot \sum_{i=1}^{1000} \zeta'(U_i)}
   where \eqn{U_i \sim \mathrm{unif}(2, 3)}
}

Negative or near-zero scores suggest insufficient non-linearity to justify
\code{df} values other than 2. Scores are not calculated for LOOCV and GCV algorithms.

Output Plots

When \code{plots = TRUE}, four lists of plots are generated:
\itemize{
   \item \code{residual_scatter_plots}: Studentized residual plots for each optimal \code{df}
   \item \code{residual_histogram_plots}: Studentized residual histograms for each optimal \code{df}
   \item \code{zeta_vs_df_plots_mor}: \eqn{\zeta} vs. \code{df} relationships using mean of replicates (mor) data
   \item \code{zeta_vs_df_plots_ar}: \eqn{\zeta} vs. \code{df} relationships using raw \code{data}
}

These plots complement the tabular output and can guide decision-making when
optimal \code{df} values may not be ideal.
}
\examples{
## Load packages
library(smooth.commutability)
library(data.table)
library(fasteqa)

## Linear data
pars <- list(n = 25, R = 3, cil = 2, ciu = 10, cvx = 0.01, cvy = 0.01, b0 = 0, b1 = 1.05)
sim_dat <- simulate_eqa_data(pars) |> setDT()
suggest_dfs <- suggest_df(data = sim_dat, ns_score = TRUE, plots = FALSE)
print(suggest_dfs)

## Non-linear data
pars <- list(n = 25, R = 3, cil = 2, ciu = 10, cvx = 0.01, cvy = 0.01, cve = 0)
sim_dat <- simulate_eqa_data2(pars, type = 2, AR = TRUE) |> setDT()
suggest_dfs <- suggest_df(data = sim_dat, ns_score = TRUE, plots = FALSE)
print(suggest_dfs)
}
